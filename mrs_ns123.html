
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‚¨ì„±ì´ˆë“±í•™êµ íšŒì˜ì‹¤ ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f5f7fb;
      --card-bg: #ffffff;
      --accent: #2563eb;
      --accent-soft: #e0ecff;
      --accent-strong: #1d4ed8;
      --border: #d4d7e5;
      --text-main: #1f2933;
      --text-sub: #6b7280;
      --danger: #dc2626;
      --slot-free: #f9fafb;
      --slot-booked: #e0f2fe;
      --slot-booked-border: #60a5fa;
      --room-gaonnuri-bg: #fee2e2;
      --room-gaonnuri-border: #fca5a5;
      --room-gyomusil-bg: #dcfce7;
      --room-gyomusil-border: #86efac;
      --room-gyoyuk-bg: #e0f2fe;
      --room-gyoyuk-border: #60a5fa;
      --room-sangdam-bg: #fef3c7;
      --room-sangdam-border: #facc15;
      --room-oxford-bg: #f5d0fe;
      --room-oxford-border: #e879f9;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.08);
      --radius-lg: 18px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #e0ebff 0, #f5f7fb 45%, #fdfdfd 100%);
      color: var(--text-main);
    }

    .app-shell {
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 16px 32px;
    }

    header.app-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
    }

    header.app-header h1 {
      margin: 0;
      font-weight: 800;
      letter-spacing: 0.03em;
      white-space: nowrap;
      font-size: clamp(1.8rem, 3vw, 2.6rem);
      color: #0f172a;
      text-shadow: 0 2px 8px rgba(15, 23, 42, 0.25);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    header.app-header h1 .logo-img {
      height: 28px;
      width: auto;
      flex-shrink: 0;
    }

    .auth-box {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);
      backdrop-filter: blur(8px);
    }

    .user-label {
      font-size: 0.85rem;
      color: var(--text-sub);
    }

    .user-name {
      font-weight: 600;
      color: var(--accent-strong);
    }

    .btn {
      border-radius: var(--radius-pill);
      border: 1px solid transparent;
      padding: 6px 12px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all 0.15s ease;
      white-space: nowrap;
      background: #fff;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      border-color: transparent;
    }

    .btn-primary:hover {
      background: var(--accent-strong);
      transform: translateY(-1px);
      box-shadow: 0 6px 12px rgba(37, 99, 235, 0.3);
    }

    .btn-submit {
      font-weight: 700;
      font-size: 0.95rem;
      padding: 10px 0;
      justify-content: center;
    }

    .btn-outline {
      border-color: var(--border);
      color: var(--text-main);
    }

    .btn-outline:hover {
      background: #eef2ff;
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .btn[disabled] {
      opacity: 0.6;
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    .pill {
      border-radius: var(--radius-pill);
      padding: 4px 10px;
      font-size: 0.8rem;
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .layout-main {
      display: grid;
      grid-template-columns: minmax(0, 320px) minmax(0, 1.4fr);
      gap: 16px;
      align-items: flex-start;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 14px 14px 16px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-header h2 {
      margin: 0;
      font-size: 1.05rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-header small {
      font-size: 0.75rem;
      color: var(--text-sub);
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 10px;
    }

    .field-label {
      font-size: 0.78rem;
      color: var(--text-sub);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .field-label span.required::after {
      content: " *";
      color: var(--danger);
    }

    .field-label small {
      font-size: 0.7rem;
    }

    .field-input,
    .field-select,
    .field-text {
      width: 100%;
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 7px 9px;
      font-size: 0.85rem;
      outline: none;
      background: #f9fafb;
      transition: all 0.12s ease;
    }

    .field-input:focus,
    .field-select:focus,
    .field-text:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
      background: #ffffff;
    }

    .field-text[readonly] {
      background: #f3f4f6;
      color: #4b5563;
    }

    .inline-fields {
      display: flex;
      gap: 8px;
    }

    .inline-fields > * {
      flex: 1;
    }

    .helper-text {
      font-size: 0.72rem;
      color: var(--text-sub);
      margin-top: -2px;
      margin-bottom: 6px;
    }

    .badge {
      font-size: 0.72rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #bfdbfe;
      background: #eff6ff;
      color: #1d4ed8;
    }

    .views-column {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .view-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 6px;
    }

    .view-title {
      font-size: 0.95rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .view-title span.tag {
      font-size: 0.72rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
      border: 1px solid #c7d2fe;
    }

    .date-nav {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.8rem;
      border-radius: 999px;
      padding: 2px 4px;
      background: #f3f4ff;
      border: 1px solid #c7d2fe;
    }

    .date-nav button {
      border: none;
      background: transparent;
      padding: 2px 6px;
      cursor: pointer;
      font-size: 0.8rem;
      border-radius: 999px;
    }

    .date-nav button:hover {
      background: rgba(79, 70, 229, 0.08);
    }

    .date-display {
      padding: 0 6px;
      font-weight: 600;
      color: #111827;
    }

    .day-grid {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
      table-layout: fixed;
    }

    .day-grid thead {
      background: #eef2ff;
    }

    .day-grid th,
    .day-grid td {
      border: 1px solid #e5e7eb;
      padding: 5px 6px;
      text-align: center;
    }

    .day-grid th {
      font-weight: 600;
      color: #374151;
    }

    .day-grid td.time-cell {
      font-weight: 600;
      background: #f9fafb;
      white-space: normal;
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .day-grid td.time-cell .time-label {
      font-size: 0.72rem;
      font-weight: 700;
      color: #111827;
      display: block;
      margin-bottom: 2px;
    }

    .day-grid td.time-cell .time-range {
      font-size: 0.68rem;
      color: #4b5563;
      display: block;
      word-break: break-all;
      overflow-wrap: anywhere;
    }

    .slot {
      min-height: 26px;
      border-radius: 999px;
      background: var(--slot-free);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2px 4px;
    }

    .slot.free span {
      font-size: 0.7rem;
      color: #9ca3af;
    }

    .slot.free {
      cursor: pointer;
    }

    .slot.booked {
      background: var(--slot-booked);
      border: 1px solid var(--slot-booked-border);
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.15);
    }

    .slot.booked span {
      font-size: 0.7rem;
      font-weight: 600;
      color: #1d4ed8;
    }

    .slot-booked-meta {
      display: block;
      font-size: 0.7rem;
      color: #4b5563;
    }

    .slot.disabled {
      background: #fee2e2;
      border: 1px solid #fecaca;
    }

    .slot.disabled span {
      font-size: 0.7rem;
      color: #b91c1c;
      font-weight: 500;
    }


    .slot.booked.room-gaonnuri,
    .week-slot-item.room-gaonnuri {
      background: var(--room-gaonnuri-bg);
      border-color: var(--room-gaonnuri-border);
    }

    .slot.booked.room-gyomusil,
    .week-slot-item.room-gyomusil {
      background: var(--room-gyomusil-bg);
      border-color: var(--room-gyomusil-border);
    }

    .slot.booked.room-gyoyuk,
    .week-slot-item.room-gyoyuk {
      background: var(--room-gyoyuk-bg);
      border-color: var(--room-gyoyuk-border);
    }

    .slot.booked.room-sangdam,
    .week-slot-item.room-sangdam {
      background: var(--room-sangdam-bg);
      border-color: var(--room-sangdam-border);
    }

    .slot.booked.room-oxford,
    .week-slot-item.room-oxford {
      background: var(--room-oxford-bg);
      border-color: var(--room-oxford-border);
    }

    .week-grid {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
      table-layout: fixed;
    }

    .week-grid thead {
      background: #f3f4ff;
    }

    .week-grid th,
    .week-grid td {
      border: 1px solid #e5e7eb;
      padding: 5px 6px;
      vertical-align: top;
    }

    .week-grid th {
      font-weight: 600;
      color: #374151;
      text-align: center;
      white-space: nowrap;
    }

    .week-grid td.room-cell {
      font-weight: 600;
      background: #f9fafb;
      white-space: normal;
      text-align: center;
      vertical-align: middle;
    }

    .week-slot-list {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .week-slot-item {
      border-radius: 10px;
      padding: 3px 6px;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1px;
      max-width: 100%;
      overflow: hidden;
      white-space: normal;
      text-align: center;
    }

    .week-slot-time {
      font-size: 0.7rem;
      font-weight: 600;
      color: #1d4ed8;
      text-align: center;
      width: 100%;
    }

    .week-slot-name {
      font-size: 0.7rem;
      color: #374151;
      text-align: center;
      width: 100%;
    }

    .week-slot-note {
      font-size: 0.7rem;
      color: #6b7280;
    }

    .empty-week-cell {
      font-size: 0.7rem;
      color: #9ca3af;
      text-align: center;
      padding: 8px 0;
    }

    .legend-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-top: 6px;
      font-size: 0.7rem;
      color: #6b7280;
      flex-wrap: wrap;
    }

    .legend-row .legend-left,
    .legend-row .legend-right {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
    }

    .legend-dot.booked {
      background: var(--slot-booked);
      border-color: var(--slot-booked-border);
    }

    .legend-dot.disabled {
      background: #fee2e2;
      border-color: #fecaca;
    }

    .alert {
      font-size: 0.75rem;
      border-radius: 10px;
      padding: 6px 8px;
      margin-bottom: 6px;
      display: flex;
      align-items: flex-start;
      gap: 6px;
    }

    .alert-info {
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
    }

    .alert-error {
      background: #fef2f2;
      color: #b91c1c;
      border: 1px solid #fecaca;
    }

    .alert-icon {
      font-size: 0.9rem;
      line-height: 1;
      margin-top: 1px;
    }

    .alert-text {
      flex: 1;
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 900px) {
      .layout-main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 640px) {
      header.app-header {
        flex-direction: column;
        align-items: flex-start;
      }

      header.app-header h1 {
        font-size: clamp(0.9rem, 4vw, 1.4rem);
        white-space: normal;
      }

      .auth-box {
        align-self: stretch;
        justify-content: space-between;
      }

      /* ëª¨ë°”ì¼ì—ì„œ í‘œ/í…ìŠ¤íŠ¸ê°€ í™”ë©´ì„ ë„˜ì§€ ì•Šë„ë¡ ì¶•ì†Œ */
      .day-grid,
      .week-grid {
        font-size: 0.7rem;
      }

      .day-grid th,
      .day-grid td,
      .week-grid th,
      .week-grid td {
        padding: 4px 3px;
      }

      .day-grid td.time-cell .time-label {
        font-size: 0.66rem;
      }

      .day-grid td.time-cell .time-range {
        font-size: 0.6rem;
      }

      .slot span {
        font-size: 0.64rem;
      }
    }

  
    /* ë‚´ ì˜ˆì•½ / ë‹¤ë¥¸ ì‚¬ëŒ ì˜ˆì•½ ìƒ‰ìƒ */
    .slot.booked.my-reservation,
    .week-slot-item.my-reservation {
      background: #bfdbfe;
      border: 1px solid #1d4ed8;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
    }

    .slot.booked.my-reservation span,
    .week-slot-item.my-reservation .week-slot-name,
    .week-slot-item.my-reservation .week-slot-time {
      color: #1d4ed8;
      font-weight: 700;
    }

    .slot.booked.other-reservation,
    .week-slot-item.other-reservation {
      background: #fffbeb;
      border: 1px solid #fef3c7;
      box-shadow: none;
    }

    .slot.booked.other-reservation span,
    .week-slot-item.other-reservation .week-slot-name,
    .week-slot-item.other-reservation .week-slot-time {
      color: #a16207;
      font-weight: 500;
    }

    .legend-dot.my-res-dot {
      background: #bfdbfe;
      border-color: #1d4ed8;
    }

    .legend-dot.other-res-dot {
      background: #fffbeb;
      border-color: #fef3c7;
    }

    /* ì£¼ê°„ ë²”ë¡€ + í† ê¸€ ì˜ì—­ */
    .week-legend-row {
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }

    .week-legend-row .legend-left {
      display: inline-flex;
      gap: 10px;
      align-items: center;
    }

    .week-legend-row .legend-right {
      display: inline-flex;
      align-items: center;
    }

    .toggle-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      color: #4b5563;
    }

    .toggle-switch {
      position: relative;
      width: 34px;
      height: 18px;
      flex-shrink: 0;
    }

    .toggle-input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #e5e7eb;
      transition: 0.2s;
      border-radius: 999px;
    }

    .toggle-slider::before {
      position: absolute;
      content: "";
      height: 14px;
      width: 14px;
      left: 2px;
      top: 2px;
      background-color: #ffffff;
      transition: 0.2s;
      border-radius: 50%;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.3);
    }

    .toggle-input:checked + .toggle-slider {
      background-color: #2563eb;
    }

    .toggle-input:checked + .toggle-slider::before {
      transform: translateX(16px);
    }
</style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <h1><img src="https://nisb.kr/plugins/custom_plugin/simple_page/assets/img/branding/logo4.png?date_ver=2025-11" alt="ë‚¨ì„±ì´ˆ ë¡œê³ " class="logo-img" />ë‚¨ì„±ì´ˆë“±í•™êµ íšŒì˜ì‹¤ ì˜ˆì•½ ì‹œìŠ¤í…œ</h1>
      <div class="auth-box">
        <div>
          <div class="user-label">
            <span id="auth-status">ë¡œê·¸ì¸ í•„ìš”</span>
          </div>
          <div class="user-name" id="auth-user-name">@nsworld.net ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”</div>
        </div>
        <div>
          <button id="login-btn" class="btn btn-primary">êµ¬ê¸€ ë¡œê·¸ì¸</button>
          <button id="logout-btn" class="btn btn-outline hidden">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>
    </header>

    <main class="layout-main">
      <!-- ì˜ˆì•½ í¼ -->
      <section class="card">
        <div class="card-header">
          <h2>ì˜ˆì•½ ë§Œë“¤ê¸°</h2>
          <span class="badge">@nsworld.net ì „ìš©</span>
        </div>

        <div id="auth-alert" class="alert alert-info">
          <div class="alert-icon">â„¹ï¸</div>
          <div class="alert-text">
            íšŒì˜ì‹¤ ì˜ˆì•½ì„ í•˜ë ¤ë©´ ë¨¼ì € <strong>@nsworld.net</strong> êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
          </div>
        </div>

        <form id="reservation-form">
          <div class="field-group">
            <label class="field-label">
              <span class="required">ì˜ˆì•½ ë‚ ì§œ</span>
            </label>
            <input type="date" id="date-input" class="field-input" required />
          </div>

          <div class="inline-fields">
            <div class="field-group">
              <label class="field-label">
                <span class="required">íšŒì˜ì‹¤</span>
              </label>
              <select id="room-select" class="field-select" required>
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="ê°€ì˜¨ëˆ„ë¦¬">ê°€ì˜¨ëˆ„ë¦¬</option>
                <option value="êµë¬´ì‹¤">êµë¬´ì‹¤</option>
                <option value="êµìœ¡ë¬¸í™”ê´€">êµìœ¡ë¬¸í™”ê´€</option>
                <option value="ìƒë‹´ì‹¤">ìƒë‹´ì‹¤</option>
                <option value="ì˜¥ìŠ¤í¼ë“œ êµì‹¤">ì˜¥ìŠ¤í¼ë“œ êµì‹¤</option>
              </select>
            </div>
            <div class="field-group">
              <label class="field-label">
                <span class="required">ì‹œê°„</span>
              </label>
              <select id="time-select" class="field-select" required>
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              </select>
            </div>
          </div>

          <div class="field-group">
            <label class="field-label">
              <span>ë°˜ë³µ ì˜ˆì•½</span>
            </label>
            <div class="inline-fields">
              <select id="repeat-select" class="field-select">
                <option value="none">ë°˜ë³µ ì—†ìŒ</option>
                <option value="weekly">ë§¤ì£¼ ê°™ì€ ìš”ì¼ ë°˜ë³µ</option>
              </select>
              <input type="date" id="repeat-until" class="field-input" />
            </div>
            <div class="helper-text">
              ë°˜ë³µ ì˜ˆì•½ì„ ì„¤ì •í•˜ëŠ” ê²½ìš°, <strong>ì¢…ë£Œì¼</strong>ê¹Œì§€ ê°™ì€ ìš”ì¼ãƒ»ì‹œê°„ãƒ»ê³µê°„ìœ¼ë¡œ ì˜ˆì•½ë©ë‹ˆë‹¤.
            </div>
          </div>

          <div class="field-group">
            <label class="field-label">
              <span>ì˜ˆì•½ì ì´ë¦„</span>
              <small>ë¡œê·¸ì¸í•œ ê³„ì • ì´ë¦„ìœ¼ë¡œ ìë™ ì—°ë™</small>
            </label>
            <input type="text" id="reserver-name" class="field-text" readonly placeholder="ë¡œê·¸ì¸ í›„ ìë™ ì…ë ¥ë©ë‹ˆë‹¤." />
          </div>

          <div class="field-group">
            <label class="field-label">
              <span>ë¹„ê³ (ì„ íƒ)</span>
            </label>
            <input type="text" id="note-input" class="field-input" placeholder="ê°„ë‹¨í•œ ìš©ë„, ëª¨ì„ ì´ë¦„ ë“±ì„ ì ì–´ì£¼ì„¸ìš”." />
          </div>

          <div id="form-error" class="alert alert-error hidden">
            <div class="alert-icon">âš ï¸</div>
            <div class="alert-text" id="form-error-text"></div>
          </div>

          <button type="submit" class="btn btn-primary btn-submit" style="width:100%; margin-top:6px;">
            ì˜ˆì•½ ë“±ë¡
          </button>
        </form>

        <p class="helper-text" style="margin-top:10px;">
          â€» ê°™ì€ ë‚ ì§œãƒ»ì‹œê°„ãƒ»íšŒì˜ì‹¤ì— ì´ë¯¸ ì˜ˆì•½ì´ ìˆëŠ” ê²½ìš°, <strong>ì¤‘ë³µ ì˜ˆì•½ì´ ìë™ìœ¼ë¡œ ì°¨ë‹¨</strong>ë©ë‹ˆë‹¤.
        </p>
      </section>

      <!-- ë³´ê¸° ì˜ì—­: ìœ„ìª½ ì¼ê°„ ì˜ˆì•½ í˜„í™© / ì•„ë˜ìª½ ì£¼ê°„ ì˜ˆì•½ í˜„í™© -->
      <section class="views-column">
        <!-- ì¼ê°„ ì˜ˆì•½ í˜„í™© -->
        <section class="card">
          <div class="view-title-row">
            <div class="view-title">
              <span>ì¼ê°„ ì˜ˆì•½ í˜„í™©</span>
              <span class="tag">ì„ íƒí•œ ë‚ ì§œ ê¸°ì¤€</span>
            </div>
            <div class="date-nav">
              <button type="button" id="prev-day">â—€</button>
              <span class="date-display" id="day-display"></span>
              <button type="button" id="next-day">â–¶</button>
            </div>
          </div>

          <table class="day-grid" id="day-grid">
            <thead>
              <tr>
                <th>ì‹œê°„</th>
                <th>ê°€ì˜¨ëˆ„ë¦¬</th>
                <th>êµë¬´ì‹¤</th>
                <th>êµìœ¡ë¬¸í™”ê´€</th>
                <th>ìƒë‹´ì‹¤</th>
                <th>ì˜¥ìŠ¤í¼ë“œ êµì‹¤</th>
              </tr>
            </thead>
            <tbody>
              <!-- JSë¡œ ì±„ì›€ -->
            </tbody>
          </table>

          <div class="legend-row">
            <div class="legend-left">
              <div class="legend-item">
                <span class="legend-dot my-res-dot"></span> <span>ë‚´ ì˜ˆì•½</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot other-res-dot"></span> <span>ë‹¤ë¥¸ ì‚¬ëŒ ì˜ˆì•½</span>
              </div>
            </div>
            <div class="legend-right">
              <div class="legend-item">
                <span class="legend-dot"></span> <span>ì˜ˆì•½ ê°€ëŠ¥</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot disabled"></span> <span>ì˜ˆì•½ ë¶ˆê°€</span>
              </div>
            </div>
          </div>
        </section>

        <!-- ì£¼ê°„ ì˜ˆì•½ í˜„í™© -->
        <section class="card">
          <div class="view-title-row">
            <div class="view-title">
              <span>ì£¼ê°„ ì˜ˆì•½ í˜„í™©</span>
              <span class="tag">ì›”ìš”ì¼ ~ ê¸ˆìš”ì¼</span>
            </div>
            <div class="date-nav">
              <button type="button" id="prev-week">â—€</button>
              <span class="date-display" id="week-display"></span>
              <button type="button" id="next-week">â–¶</button>
            </div>
          </div>

          <table class="week-grid" id="week-grid">
            <thead>
              <tr>
                <th>íšŒì˜ì‹¤</th>
                <th>ì›”</th>
                <th>í™”</th>
                <th>ìˆ˜</th>
                <th>ëª©</th>
                <th>ê¸ˆ</th>
              </tr>
            </thead>
            <tbody>
              <!-- JSë¡œ ì±„ì›€ -->
            </tbody>
          </table>

          <div class="legend-row week-legend-row">
            <div class="legend-left">
              <div class="legend-item">
                <span class="legend-dot my-res-dot"></span> <span>ë‚´ ì˜ˆì•½</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot other-res-dot"></span> <span>ë‹¤ë¥¸ ì‚¬ëŒ ì˜ˆì•½</span>
              </div>
            </div>
            <div class="legend-right">
              <label class="toggle-label">
                <span><strong>ë‚´ ì˜ˆì•½ë§Œ ë³´ê¸°</strong></span>
                <div class="toggle-switch">
                  <input type="checkbox" id="my-week-only-toggle" class="toggle-input" />
                  <span class="toggle-slider"></span>
                </div>
              </label>
            </div>
          </div>
        </section>
      </section>
    </main>
  </div>

  
<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  // Firebase ì„¤ì •
  const firebaseConfig = {
    apiKey: "AIzaSyAvlHnsZJ1kFBw7LXTtwlheShJk96yH960",
    authDomain: "namsung-meeting-room-7811f.firebaseapp.com",
    projectId: "namsung-meeting-room-7811f",
    storageBucket: "namsung-meeting-room-7811f.firebasestorage.app",
    messagingSenderId: "863278514186",
    appId: "1:863278514186:web:827dfd1ffc8947918e1ff3"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
</script>

<script>
  // ---- ìƒìˆ˜ ì •ì˜ ----
  const ROOMS = ["ê°€ì˜¨ëˆ„ë¦¬", "êµë¬´ì‹¤", "êµìœ¡ë¬¸í™”ê´€", "ìƒë‹´ì‹¤", "ì˜¥ìŠ¤í¼ë“œ êµì‹¤"];

  const ROOM_CLASS_MAP = {
    "ê°€ì˜¨ëˆ„ë¦¬": "room-gaonnuri",
    "êµë¬´ì‹¤": "room-gyomusil",
    "êµìœ¡ë¬¸í™”ê´€": "room-gyoyuk",
    "ìƒë‹´ì‹¤": "room-sangdam",
    "ì˜¥ìŠ¤í¼ë“œ êµì‹¤": "room-oxford"
  };


  const TIME_SLOTS = [
    "08:30~08:55",
    "09:00~09:40",
    "09:45~10:25",
    "10:30~11:10",
    "11:15~11:55",
    "12:00~12:40",
    "12:40~13:25",
    "13:30~14:10",
    "14:15~14:55",
    "15:00~15:40",
    "15:40~16:30"
  ];


  const TIME_LABELS = [
    "ì•„ì¹¨ì‹œê°„",
    "1êµì‹œ",
    "2êµì‹œ",
    "3êµì‹œ",
    "4êµì‹œ",
    "5êµì‹œ",
    "ì ì‹¬ì‹œê°„",
    "6êµì‹œ",
    "7êµì‹œ",
    "8êµì‹œ",
    "ì¼ê³¼í›„"
  ];

  // Firestore ì—°ë™ìš© ì˜ˆì•½ ìºì‹œ
  let reservations = []; // {id, date(YYYY-MM-DD), room, timeSlotIndex, name, note}
  let weekShowMyOnly = false;

  let currentUser = null; // {name, email}
  let selectedDate = new Date();
  let weekBaseDate = new Date();

  // ---- ìœ í‹¸ í•¨ìˆ˜ ----
  function formatDateKey(date) {
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, "0");
    const d = String(date.getDate()).padStart(2, "0");
    return `${y}-${m}-${d}`;
  }

  function parseDateFromInput(value) {
    if (!value) return null;
    const [y, m, d] = value.split("-").map(Number);
    return new Date(y, m - 1, d);
  }

  function formatKoreanDate(date) {
    const dayNames = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
    const y = date.getFullYear();
    const m = date.getMonth() + 1;
    const d = date.getDate();
    const w = dayNames[date.getDay()];
    return `${y}. ${m}. ${d}. (${w})`;
  }

  function getWeekRange(date) {
    const base = new Date(date);
    const day = base.getDay(); // 0(ì¼)~6(í† )
    const diffToMonday = (day + 6) % 7;
    const monday = new Date(base);
    monday.setDate(base.getDate() - diffToMonday);
    const sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6);
    return { monday, sunday };
  }

  function hasConflict(dateKey, room, timeSlotIndex) {
    return reservations.some(
      (r) => r.date === dateKey && r.room === room && r.timeSlotIndex === timeSlotIndex
    );
  }

  function isWeekday(date) {
    const day = date.getDay(); // 0:ì¼ ~ 6:í† 
    return day >= 1 && day <= 5; // ì›”~ê¸ˆë§Œ í—ˆìš©
  }


  function isConsultingBlocked(date, room) {
    if (room !== "ìƒë‹´ì‹¤") return false;
    const cutoff = new Date(2026, 1, 28); // 2026-02-28
    if (date > cutoff) return false;
    const day = date.getDay(); // 0(ì¼)~6(í† )
    return day === 4 || day === 5; // ëª©(4), ê¸ˆ(5)
  }

  function isRoomTimeBlocked(date, room, timeSlotIndex) {
    const day = date.getDay(); // 0(ì¼)~6(í† )

    // 1) ìƒë‹´ì‹¤: ê¸°ì¡´ ê·œì¹™ (2026.2.28ê¹Œì§€ ëª©/ê¸ˆ ì „ì²´ ì‹œê°„ëŒ€)
    if (isConsultingBlocked(date, room)) {
      return true;
    }

    // 2) ì˜¥ìŠ¤í¼ë“œ êµì‹¤: ë§¤ì¼ ì ì‹¬ì‹œê°„(12:40~13:25, TIME_LABELS index 6) ì˜ˆì•½ ë¶ˆê°€
    if (room === "ì˜¥ìŠ¤í¼ë“œ êµì‹¤" && timeSlotIndex === 6) {
      return true;
    }

    // 3) êµë¬´ì‹¤: ì›”, ê¸ˆìš”ì¼ 7, 8êµì‹œ ì˜ˆì•½ ë¶ˆê°€
    // 7êµì‹œ: index 8, 8êµì‹œ: index 9
    if (room === "êµë¬´ì‹¤" && (day === 1 || day === 5) && (timeSlotIndex === 8 || timeSlotIndex === 9)) {
      return true;
    }

    // 4) ê°€ì˜¨ëˆ„ë¦¬: 2026.2.28ê¹Œì§€ ì›”, í™”, ê¸ˆìš”ì¼ 3,4,5,6êµì‹œ ì˜ˆì•½ ë¶ˆê°€
    // 3êµì‹œ: index 3, 4êµì‹œ: 4, 5êµì‹œ: 5, 6êµì‹œ: 7
    if (room === "ê°€ì˜¨ëˆ„ë¦¬") {
      const cutoffGaon = new Date(2026, 1, 28); // 2026-02-28
      if (date <= cutoffGaon &&
          (day === 1 || day === 2 || day === 5) &&
          ([3,4,5,7].includes(timeSlotIndex))) {
        return true;
      }
    }

    // 5) êµìœ¡ë¬¸í™”ê´€: 2026.2.28ê¹Œì§€ ì›”, í™”, ê¸ˆìš”ì¼ 3,4,5,6êµì‹œ ì˜ˆì•½ ë¶ˆê°€
    // 3êµì‹œ: index 3, 4êµì‹œ: 4, 5êµì‹œ: 5, 6êµì‹œ: 7
    //      + ì ì‹¬ì‹œê°„(12:40~13:25, index 6)ì€ ê¸°ê°„ ìƒê´€ì—†ì´ í•­ìƒ ì˜ˆì•½ ë¶ˆê°€
    if (room === "êµìœ¡ë¬¸í™”ê´€") {
      // ì ì‹¬ì‹œê°„ì€ í•­ìƒ ì˜ˆì•½ ë¶ˆê°€
      if (timeSlotIndex === 6) {
        return true;
      }
      const cutoffEdu = new Date(2026, 1, 28); // 2026-02-28
      if (date <= cutoffEdu &&
          (day === 1 || day === 2 || day === 5) &&
          ([3,4,5,7].includes(timeSlotIndex))) {
        return true;
      }
    }

    return false;
  }

  async function handleQuickReserve(room, timeIndex) {
    clearError();

    if (!currentUser) {
      showError("@nsworld.net ê³„ì •ìœ¼ë¡œ ë¨¼ì € ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.");
      return;
    }

    const date = new Date(selectedDate);
    const dateKey = formatDateKey(date);
    const existing = reservations.find(
      (r) => r.date === dateKey && r.room === room && r.timeSlotIndex === timeIndex
    );

    const currentName = currentUser.name || currentUser.email;

    // ì´ë¯¸ ì˜ˆì•½ëœ ìƒíƒœë¼ë©´: ë³¸ì¸ ì˜ˆì•½ë§Œ ì·¨ì†Œ ê°€ëŠ¥
    if (existing) {
      if (existing.name !== currentName) {
        showError("ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì˜ˆì•½ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      await deleteReservation(existing.id);
      await fetchReservations();
      return;
    }

    // ë¹„ì–´ ìˆëŠ” ìƒíƒœë¼ë©´: ìƒˆë¡œ ì˜ˆì•½ (ì›”~ê¸ˆë§Œ)
    if (!isWeekday(date)) {
      showError("ì˜ˆì•½ì€ ì›”ìš”ì¼ë¶€í„° ê¸ˆìš”ì¼ê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }

    if (isRoomTimeBlocked(date, room, timeIndex)) {
      showError("í•´ë‹¹ íšŒì˜ì‹¤/ì‹œê°„ëŒ€ëŠ” í˜„ì¬ ì˜ˆì•½ì´ ë¶ˆê°€í•œ ì‹œê°„ì…ë‹ˆë‹¤.");
      return;
    }

    if (await addReservation(dateKey, room, timeIndex, currentName, "")) {
      await fetchReservations();
    } else {
      showError("ì„ íƒí•œ ì‹œê°„ì—ëŠ” ì´ë¯¸ ì˜ˆì•½ì´ ì¡´ì¬í•©ë‹ˆë‹¤.");
    }
  }


  async function handleWeekItemClick(reservation) {
    clearError();

    if (!currentUser) {
      showError("@nsworld.net ê³„ì •ìœ¼ë¡œ ë¨¼ì € ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.");
      return;
    }

    const currentName = currentUser.name || currentUser.email;

    if (reservation.name !== currentName) {
      showError("ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì˜ˆì•½ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      return;
    }

    await deleteReservation(reservation.id);
    await fetchReservations();
  }

  // ---- Firestore ì—°ë™ ----
  async function fetchReservations() {
    const snapshot = await db.collection("reservations").get();

    const now = new Date();
    const cutoff = new Date();
    cutoff.setDate(now.getDate() - 14);
    const cutoffKey = formatDateKey(cutoff);

    const active = [];
    const toDelete = [];

    snapshot.forEach((doc) => {
      const data = doc.data();
      const dateKey = data.date;
      if (dateKey && dateKey < cutoffKey) {
        toDelete.push(doc.ref);
      } else {
        active.push({
          id: doc.id,
          ...data
        });
      }
    });

    if (toDelete.length > 0) {
      const batch = db.batch();
      toDelete.forEach((ref) => batch.delete(ref));
      await batch.commit();
    }

    reservations = active;
    renderDayView();
    renderWeekView();
  }

  async function addReservation(dateKey, room, timeSlotIndex, name, note) {
    if (hasConflict(dateKey, room, timeSlotIndex)) {
      return false;
    }

    const docRef = await db.collection("reservations").add({
      date: dateKey,
      room,
      timeSlotIndex,
      name,
      note: note || ""
    });

    reservations.push({
      id: docRef.id,
      date: dateKey,
      room,
      timeSlotIndex,
      name,
      note: note || ""
    });

    return true;
  }

  async function deleteReservation(id) {
    await db.collection("reservations").doc(id).delete();
    reservations = reservations.filter((r) => r.id !== id);
  }

  // ---- UI ë Œë”ë§ ----
  function renderDayView() {
    const tbody = document.querySelector("#day-grid tbody");
    tbody.innerHTML = "";
    const dateKey = formatDateKey(selectedDate);
    const weekend = !isWeekday(selectedDate);

    TIME_SLOTS.forEach((slot, index) => {
      const tr = document.createElement("tr");

      const timeTd = document.createElement("td");
      timeTd.className = "time-cell";
      const labelDiv = document.createElement("div");
      labelDiv.className = "time-label";
      labelDiv.textContent = TIME_LABELS[index];
      const rangeDiv = document.createElement("div");
      rangeDiv.className = "time-range";
      rangeDiv.textContent = slot;
      timeTd.appendChild(labelDiv);
      timeTd.appendChild(rangeDiv);
      tr.appendChild(timeTd);

      ROOMS.forEach((room) => {
        const td = document.createElement("td");
        const slotDiv = document.createElement("div");

        const blocked = isRoomTimeBlocked(selectedDate, room, index);

        if (weekend || blocked) {
          // í† /ì¼ ë˜ëŠ” íšŒì˜ì‹¤/ì‹œê°„ëŒ€ë³„ ì˜ˆì•½ ë¶ˆê°€
          slotDiv.className = "slot disabled";
          const main = document.createElement("span");
          main.textContent = "ì˜ˆì•½ ë¶ˆê°€";
          slotDiv.appendChild(main);
        } else {
          const existing = reservations.find(
            (r) => r.date === dateKey && r.room === room && r.timeSlotIndex === index
          );

          if (existing) {
            const currentName = currentUser ? (currentUser.name || currentUser.email) : null;
            const isMine = currentName && existing.name === currentName;
            const ownerClass = isMine ? "my-reservation" : "other-reservation";
            slotDiv.className = "slot booked " + ownerClass;
            const main = document.createElement("span");
            main.textContent = existing.name; // ì˜ˆì•½ìëª…ë§Œ í‘œì‹œ
            slotDiv.appendChild(main);
            slotDiv.addEventListener("click", () => {
              handleQuickReserve(room, index);
            });
          } else {
            slotDiv.className = "slot free";
            const main = document.createElement("span");
            main.textContent = "ì˜ˆì•½ ê°€ëŠ¥";
            slotDiv.appendChild(main);
            // ë¹ ë¥¸ ì˜ˆì•½: ë¹ˆ ìŠ¬ë¡¯ í´ë¦­ ì‹œ ì¦‰ì‹œ ì˜ˆì•½/ì·¨ì†Œ í† ê¸€
            slotDiv.addEventListener("click", () => {
              handleQuickReserve(room, index);
            });
          }
        }

        td.appendChild(slotDiv);
        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });

    document.getElementById("day-display").textContent = formatKoreanDate(selectedDate);
  }

  function renderWeekView() {
    const tbody = document.querySelector("#week-grid tbody");
    tbody.innerHTML = "";

    const { monday, sunday } = getWeekRange(weekBaseDate);

    document.getElementById("week-display").textContent =
      `${monday.getFullYear()}. ${monday.getMonth() + 1}. ${monday.getDate()} ~ ` +
      `${sunday.getFullYear()}. ${sunday.getMonth() + 1}. ${sunday.getDate()}`;

    ROOMS.forEach((room) => {
      const tr = document.createElement("tr");

      const roomTd = document.createElement("td");
      roomTd.className = "room-cell";
      roomTd.textContent = room;
      tr.appendChild(roomTd);

      for (let i = 0; i < 5; i++) {
        const dayDate = new Date(monday);
        dayDate.setDate(monday.getDate() + i);
        const dateKey = formatDateKey(dayDate);

        const td = document.createElement("td");

        let roomReservations = reservations
          .filter((r) => r.date === dateKey && r.room === room)
          .sort((a, b) => a.timeSlotIndex - b.timeSlotIndex);

        if (weekShowMyOnly && currentUser) {
          const currentName = currentUser.name || currentUser.email;
          roomReservations = roomReservations.filter((r) => r.name === currentName);
        }

        if (roomReservations.length === 0) {
          const empty = document.createElement("div");
          empty.className = "empty-week-cell";
          empty.textContent = "-";
          td.appendChild(empty);
        } else {
          const list = document.createElement("div");
          list.className = "week-slot-list";

          roomReservations.forEach((r) => {
            const item = document.createElement("div");
            const currentName = currentUser ? (currentUser.name || currentUser.email) : null;
            const isMine = currentName && r.name === currentName;
            const ownerClass = isMine ? "my-reservation" : "other-reservation";
            item.className = "week-slot-item " + ownerClass;

            const timeSpan = document.createElement("span");
            timeSpan.className = "week-slot-time";
            timeSpan.textContent = TIME_SLOTS[r.timeSlotIndex];

            const nameSpan = document.createElement("span");
            nameSpan.className = "week-slot-name";
            nameSpan.textContent = r.name; // ì˜ˆì•½ìëª…ë§Œ í‘œì‹œ

            item.appendChild(timeSpan);
            item.appendChild(nameSpan);

            // ì£¼ê°„ ë³´ê¸°ì—ì„œë„ í´ë¦­ ì‹œ ì˜ˆì•½ ì·¨ì†Œ ê°€ëŠ¥ (ë³¸ì¸ ì˜ˆì•½ë§Œ)
            item.addEventListener("click", () => {
              handleWeekItemClick(r);
            });

            list.appendChild(item);
          });

          td.appendChild(list);
        }

        tr.appendChild(td);
      }

      tbody.appendChild(tr);
    });
  }

  function syncDateInputs() {
    const dateInput = document.getElementById("date-input");
    dateInput.value = formatDateKey(selectedDate);
  }

  function showError(message) {
    const box = document.getElementById("form-error");
    const textEl = document.getElementById("form-error-text");
    textEl.textContent = message;
    box.classList.remove("hidden");
  }

  function clearError() {
    const box = document.getElementById("form-error");
    box.classList.add("hidden");
  }

  function updateAuthUI() {
    const status = document.getElementById("auth-status");
    const name = document.getElementById("auth-user-name");
    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const reserverName = document.getElementById("reserver-name");
    const authAlert = document.getElementById("auth-alert");

    if (currentUser) {
      status.textContent = "ë¡œê·¸ì¸ë¨";
      name.textContent = currentUser.email;
      reserverName.value = currentUser.name || currentUser.email;
      authAlert.classList.add("hidden");
      loginBtn.classList.add("hidden");
      logoutBtn.classList.remove("hidden");
    } else {
      status.textContent = "ë¡œê·¸ì¸ í•„ìš”";
      name.textContent = "@nsworld.net ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”";
      reserverName.value = "";
      authAlert.classList.remove("hidden");
      loginBtn.classList.remove("hidden");
      logoutBtn.classList.add("hidden");
    }
  }

  // ---- Google ë¡œê·¸ì¸ ----
  function googleLogin() {
    const provider = new firebase.auth.GoogleAuthProvider();

    auth.signInWithPopup(provider)
      .then((result) => {
        const user = result.user;
        const email = user.email || "";
        const name = user.displayName || email.split("@")[0];

        if (!email.endsWith("@nsworld.net")) {
          alert("@nsworld.net ë„ë©”ì¸ ê³„ì •ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          return auth.signOut();
        }

        currentUser = { name, email };
        updateAuthUI();
      })
      .catch((error) => {
        console.error(error);
        alert("ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      });
  }

  function googleLogout() {
    auth.signOut().then(() => {
      currentUser = null;
      updateAuthUI();
    });
  }

  // ---- ì´ˆê¸°í™” ----
  function initTimeOptions() {
    const select = document.getElementById("time-select");
    TIME_SLOTS.forEach((slot, index) => {
      const opt = document.createElement("option");
      opt.value = String(index);
      opt.textContent = slot;
      select.appendChild(opt);
    });
  }

  function initDateDefaults() {
    const dateInput = document.getElementById("date-input");
    const todayKey = formatDateKey(selectedDate);
    dateInput.value = todayKey;
    weekBaseDate = new Date(selectedDate);
  }

  function attachEventHandlers() {
    document.getElementById("login-btn").addEventListener("click", googleLogin);
    document.getElementById("logout-btn").addEventListener("click", googleLogout);

    document.getElementById("date-input").addEventListener("change", (e) => {
      const d = parseDateFromInput(e.target.value);
      if (d) {
        selectedDate = d;
        weekBaseDate = new Date(d);
        renderDayView();
        renderWeekView();
      }
    });

    document.getElementById("prev-day").addEventListener("click", () => {
      selectedDate.setDate(selectedDate.getDate() - 1);
      weekBaseDate = new Date(selectedDate);
      syncDateInputs();
      renderDayView();
      renderWeekView();
    });

    document.getElementById("next-day").addEventListener("click", () => {
      selectedDate.setDate(selectedDate.getDate() + 1);
      weekBaseDate = new Date(selectedDate);
      syncDateInputs();
      renderDayView();
      renderWeekView();
    });

    document.getElementById("prev-week").addEventListener("click", () => {
      weekBaseDate.setDate(weekBaseDate.getDate() - 7);
      renderWeekView();
    });

    document.getElementById("next-week").addEventListener("click", () => {
      weekBaseDate.setDate(weekBaseDate.getDate() + 7);
      renderWeekView();
    });

    const myWeekToggle = document.getElementById("my-week-only-toggle");
    if (myWeekToggle) {
      myWeekToggle.addEventListener("change", (e) => {
        weekShowMyOnly = e.target.checked;
        renderWeekView();
      });
    }

    document.getElementById("reservation-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      clearError();

      if (!currentUser) {
        showError("@nsworld.net ê³„ì •ìœ¼ë¡œ ë¨¼ì € ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.");
        return;
      }

      const dateVal = document.getElementById("date-input").value;
      const roomVal = document.getElementById("room-select").value;
      const timeVal = document.getElementById("time-select").value;
      const repeatVal = document.getElementById("repeat-select").value;
      const repeatUntilVal = document.getElementById("repeat-until").value;
      const noteVal = document.getElementById("note-input").value.trim();
      const nameVal = document.getElementById("reserver-name").value.trim() || currentUser.name;

      if (!dateVal || !roomVal || timeVal === "") {
        showError("ì˜ˆì•½ ë‚ ì§œ, íšŒì˜ì‹¤, ì‹œê°„ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”.");
        return;
      }

      const baseDate = parseDateFromInput(dateVal);
      if (!baseDate) {
        showError("ì˜ëª»ëœ ë‚ ì§œ í˜•ì‹ì…ë‹ˆë‹¤.");
        return;
      }

      if (!isWeekday(baseDate)) {
        showError("ì˜ˆì•½ì€ ì›”ìš”ì¼ë¶€í„° ê¸ˆìš”ì¼ê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        return;
      }

      const timeIndex = parseInt(timeVal, 10);
      if (isRoomTimeBlocked(baseDate, roomVal, timeIndex)) {
        showError("í•´ë‹¹ íšŒì˜ì‹¤/ì‹œê°„ëŒ€ëŠ” í˜„ì¬ ì˜ˆì•½ì´ ë¶ˆê°€í•œ ì‹œê°„ì…ë‹ˆë‹¤.");
        return;
      }

      const baseDateKey = formatDateKey(baseDate);

      let successCount = 0;
      let conflictCount = 0;

      if (repeatVal === "none") {
        if (await addReservation(baseDateKey, roomVal, timeIndex, nameVal, noteVal)) {
          successCount++;
        } else {
          conflictCount++;
        }
      } else if (repeatVal === "weekly") {
        const untilDate = parseDateFromInput(repeatUntilVal);
        if (!untilDate) {
          showError("ë°˜ë³µ ì˜ˆì•½ì˜ ì¢…ë£Œì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");
          return;
        }
        if (untilDate < baseDate) {
          showError("ë°˜ë³µ ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.");
          return;
        }

        const tempDate = new Date(baseDate);
        while (tempDate <= untilDate) {
          const key = formatDateKey(tempDate);
          if (await addReservation(key, roomVal, timeIndex, nameVal, noteVal)) {
            successCount++;
          } else {
            conflictCount++;
          }
          tempDate.setDate(tempDate.getDate() + 7);
        }
      }

      if (conflictCount > 0 && successCount === 0) {
        showError("ì„ íƒí•œ ì¡°ê±´ìœ¼ë¡œ ì´ë¯¸ ì˜ˆì•½ì´ ì¡´ì¬í•˜ì—¬ ë“±ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      } else if (conflictCount > 0) {
        showError(`ì¼ë¶€ ë‚ ì§œëŠ” ì´ë¯¸ ì˜ˆì•½ì´ ìˆì–´ ì œì™¸ë˜ì—ˆìœ¼ë©°, ${successCount}ê±´ì˜ ì˜ˆì•½ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      }

      await fetchReservations(); // ìµœì‹  ìƒíƒœ ë‹¤ì‹œ ë°˜ì˜
    });
  }

  // ---- ì¸ì¦ ìƒíƒœ ë³€í™” ê°ì§€ ----
auth.onAuthStateChanged(async (user) => {
  if (user) {
    const email = user.email || "";
    const name = user.displayName || email.split("@")[0];

    if (!email.endsWith("@nsworld.net")) {
      alert("@nsworld.net ë„ë©”ì¸ ê³„ì •ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      await auth.signOut();
      return;
    }

    currentUser = { name, email };
  } else {
    currentUser = null;
  }

  updateAuthUI();

  // ğŸ”½ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ìƒíƒœê°€ ë°”ë€” ë•Œë§ˆë‹¤
  //     ìµœì‹  ì‚¬ìš©ì ì •ë³´ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ì‹œ ê°€ì ¸ì™€ì„œ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
  await fetchReservations();
});


  // ---- ì‹œì‘ ----
  document.addEventListener("DOMContentLoaded", async () => {
    initTimeOptions();
    initDateDefaults();
    updateAuthUI();
    attachEventHandlers();
  });
</script>
</body>
</html>
